<template>
    <div class="column">
        <div class="row1">
            <lightning-icon icon-name="standard:metrics" size="large"></lightning-icon>
            <span class="app-title">Observability (o11y) Sample App</span>
            <a href="https://confluence.internal.salesforce.com/display/LIGHTINS/Lightning+Instrumentation+Home"
                target="_blank">Documentation</a>
        </div>
        <div class="row2">
            <div class="slds-grid slds-wrap">
                <div class="slds-col slds-size_8-of-12">
                    <lightning-tabset variant="vertical" active-tab-value={selectedSection}>
                        <lightning-tab label={labelIntro} value={sectionIntro} onactive={handleTabSelect}>
                            <my-app-section label={labelIntro} icon-name="custom:custom107">
                                <div slot="doc">
                                    <p class="header">Welcome!</p>
                                    <p>
                                        This sample app demonstrates the usage of the new instrumentation platform
                                        "Olly", provided by the o11y module. To play around, go ahead and experiment
                                        with the different tabs.
                                    </p>
                                    <p>
                                        In Salesforce Core cases, the instrumentation platform will have been
                                        initialized for you by the environment. If not, such as in an off-core LWC app
                                        like this one, the top-level entity must initialize it before use. Please refer
                                        to the <code>initializeInstrumentation()</code> method in app.js for an example.
                                    </p>
                                    <p>
                                        To start instrumenting your code, add the following import:
                                    </p>
                                    <pre>import &#123; getInstrumentation &#125; from 'o11y/client';</pre>
                                    <p>In your constructor, get an instrumentation instance:</p>
                                    <pre>this.instr = getInstrumentation('my_instrumentation_name');</pre>
                                    <p>You can then call the available methods on this instance. This functionality is
                                        demonstrated in the other sections of this app.</p>
                                    <p>The instrumentation platform redirects logs to registered log collectors. This
                                        app registers 3 such entities:
                                    </p>
                                    <ol>
                                        <li>A <em>Console collector</em>, which outputs to the developer console in your
                                            browser,
                                        </li>
                                        <li>A <em>Visual collector</em>, which creates entries in to the bottom section
                                            of the app, </li>
                                        <li>A <em>Core Collector</em>, which is exported by the o11y module and sends
                                            logs to a server-side endpoint. This sample app project comes with a local
                                            server, but you can also use a Salesforce instance you have access to.</li>
                                    </ol>
                                    <p class="header">To Debug This App:</p>
                                    <div>
                                        <ol>
                                            <li>Launch the <em>Developer Tools.</em></li>
                                            <li>Select the <em>Sources</em> tab on the tab and the <em>Page</em> tab on
                                                the left.
                                            </li>
                                            <li>Drill down to <em> top &gt; o11y-sample &gt; . &gt; src &gt; client &gt;
                                                    modules/my</em>.</li>
                                            <li>Drill down further to the LWC component you want to debug and select the
                                                .js file. Experiments are organized into individual LWC components, with
                                                the suffix <em> Play</em>.
                                            </li>
                                            <li>Set a breakpoint.</li>
                                            <li>Run the experiment.</li>
                                        </ol>
                                    </div>
                                </div>
                            </my-app-section>
                        </lightning-tab>
                        <lightning-tab label={labelErrors} value={sectionErrors} onactive={handleTabSelect}>
                            <my-app-section label={labelErrors} icon-name="custom:custom34">
                                <div slot="doc">
                                    To log an error:
                                    <pre>this.instr.error(err); // err is an instance of Error</pre>
                                    <p>
                                        For other usages, please refer to the <a
                                            href="https://confluence.internal.salesforce.com/display/LIGHTINS/Instrumentation+Object#InstrumentationObject-error"
                                            target="_blank">error
                                            API documentation</a>.
                                    </p>
                                </div>
                                <div slot="play">
                                    <my-error-play></my-error-play>
                                </div>
                            </my-app-section>
                        </lightning-tab>
                        <lightning-tab label={labelActivities} value={sectionActivities} onactive={handleTabSelect}>
                            <my-app-section label={labelActivities} icon-name="standard:operating_hours">
                                <div slot="doc">
                                    To log the duration of a long-running activity, use the activity API:
                                    <pre>
                                        const act = this.instr.startActivity('my-long-process');<br>
                                        // ... long process ...<br>
                                        act.stop();
                                    </pre>
                                    <p>
                                        For other usages, please refer to the <a
                                            href="https://confluence.internal.salesforce.com/display/LIGHTINS/Instrumentation+Object#InstrumentationObject-startActivity"
                                            target="_blank">startActivity
                                            API documentation</a>.
                                    </p>
                                    <p>
                                        The sample app creates a <em>root activity</em> to capture the duration of the
                                        active tab.
                                    </p>
                                </div>
                                <div slot="play">
                                    <my-activity activity-name="Activity 1"></my-activity>
                                    <my-activity activity-name="Activity 2"></my-activity>
                                    <my-activity activity-name="Activity 3"></my-activity>
                                </div>
                            </my-app-section>
                        </lightning-tab>
                        <lightning-tab label={labelEvents} value={sectionEvents} onactive={handleTabSelect}>
                            <my-app-section label={labelEvents} icon-name="standard:custom_notification">
                                <div slot="doc">
                                    <p>The o11y module comes with an <em>Automatic Click Tracker (ACT)</em>. If it is
                                        activated by the app, mouse-clicks on buttons, anchors and inputs of type button
                                        will be captured in logs.</p>
                                    <p>A developer can choose to log clicks or other DOM events in their event handler
                                        using the <code>domEvent</code> API designed specifically for this purpose. In
                                        addition to capturing the same event data that the ACT would, it allows the
                                        developer to provide additional data to be included in the same log
                                        entry.</p>
                                    <p> For more detail, please refer to the <a
                                            href="https://confluence.internal.salesforce.com/display/LIGHTINS/Instrumentation+Object#InstrumentationObject-domEvent"
                                            target="_blank">domEvent
                                            API documentation</a>.
                                    </p>
                                    <div>
                                        <lightning-badge label="Note" icon-name="utility:warning"></lightning-badge>
                                        <span>
                                            Currently, only mouse-click events are supported.
                                        </span>
                                    </div>
                                </div>
                                <div slot="play">
                                    <my-instrumented-event-play slot="play" is-act-active={clickTrackActive}
                                        ontoggleact={handleToggleAct}></my-instrumented-event-play>
                                </div>
                            </my-app-section>
                        </lightning-tab>
                        <lightning-tab label={labelCustom} value={sectionCustom} onactive={handleTabSelect}>
                            <my-app-section label={labelCustom} icon-name="standard:record">
                                <div slot="doc">
                                    <span class="header">In general, to log a custom message:</span>
                                    <ol>
                                        <li>First define the structure of your message as a schema, and have it
                                            checked-in to the schema repo.</li>
                                        <li>Import your schema from the schema NPM module.</li>
                                        <li>Pass the schema as the first argument to the log method and a compliant data
                                            as the second. </li>
                                    </ol>
                                    <pre>
                                        import &#123; mySchema &#125; from 'o11ysample/schemas';<br>
                                        // ...<br>
                                        this.instr.log(mySchema, myData);
                                    </pre>
                                    <span class="header">To log a sample message defined by this app:</span>
                                    <p>
                                        The data passed to the <code>log</code> API needs to comply with the following
                                        <a href="https://developers.google.com/protocol-buffers/docs/proto3"
                                            target="_blank"> proto3</a> schema:
                                    </p>
                                    <pre class="proto3">
                                        syntax = "proto3";<br>
                                        package sf.instrumentation;<br><br>
                                        message O11ySample &#123;<br>   bool bool = 1;<br>   string string = 2;<br>   int32 int32 = 3;<br>   int32 int64 = 4;<br>   uint32 = 5;<br>   uint64 uint64 = 6;<br>   double double = 7;<br>    
                                        &#125;
                                    </pre>
                                    <div>
                                        <lightning-badge label="Note" icon-name="utility:warning"></lightning-badge>
                                        <span>
                                            The schemas are currently embedded in this project, but this will soon
                                            change, when schemas must be imported via a separate module.
                                        </span>
                                    </div>
                                </div>
                                <my-custom-play slot="play"></my-custom-play>
                            </my-app-section>
                        </lightning-tab>
                    </lightning-tabset>
                </div>
                <div class="slds-col slds-size_4-of-12">
                    <div class="collector-pane">
                        <div class="collector-header">
                            <span class="collector-header-title">Logs</span>
                            <lightning-badge if:true={logs.length} label={logs.length}></lightning-badge>
                            <lightning-button if:true={logs.length} label="Clear" title="Clear the log entries"
                                onclick={handleClearLogs} variant="destructive" icon-name="utility:delete"
                                class="slds-m-left_x-small">
                            </lightning-button>
                        </div>
                        <div class="collector-body">
                            <my-visual-collector logs={logs}></my-visual-collector>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row3">
        </div>
    </div>
</template>